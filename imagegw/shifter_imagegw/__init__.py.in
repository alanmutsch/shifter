import os
import json
import logging
from flask import Flask, Blueprint, request, Response, url_for, jsonify

# Default Configuration
configPath='@SHIFTER_SYSCONFDIR@'
DEBUG_FLAG = True
LISTEN_PORT = 5000
AUTH_HEADER = 'authentication'
app = None
mgr = None
config={}

app = Flask(__name__)

from shifter_imagegw import imagegwapi

def init(configfile):
    from shifter_imagegw import imagemngr
    app.logger.info("initializing with %s"%(configfile))
    global mgr
    global config
    with open(configfile) as config_file:
        config = json.load(config_file)
    mgr=imagemngr.imagemngr(config,logname='imagegwapi')
    print mgr

app.logger.setLevel(logging.INFO)
ch = logging.StreamHandler()
formatter = logging.Formatter('%(asctime)s [%(name)s] %(levelname)s : %(message)s')
ch.setFormatter(formatter)
ch.setLevel(logging.DEBUG)
app.logger.addHandler(ch)
app.logger.debug('Initializing image manager')

if 'GWCONFIG' in os.environ:
    CONFIG=os.environ['GWCONFIG']
else:
    CONFIG='%s/imagemanager.json' % (shifter_imagegw.configPath)
init(CONFIG)
